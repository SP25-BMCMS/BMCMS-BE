// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
  output   = "../../../node_modules/@prisma/client-Task"
}

datasource db {
  provider = "postgresql"
  url      = env("DB_TASKS_SERVICE")
}

model Task {
  task_id         String    @id @default(uuid()) // Changed to UUID
  description     String
  status          Status
  created_at      DateTime  @default(now())
  updated_at      DateTime  @updatedAt
  crack_id        String
  schedule_job_id String
  // Mối quan hệ 1:N với WorkLogs
  workLogs        WorkLog[]

  // Mối quan hệ 1:N với TaskAssignments
  taskAssignments TaskAssignment[]

  // Mối quan hệ 1:N với Inspections
}

model WorkLog {
  worklog_id  String   @id @default(uuid()) // Changed to UUID
  task_id     String
  title       String
  description String
  created_at  DateTime @default(now())
  updated_at  DateTime @updatedAt

  // Mối quan hệ N:1 với Task
  task Task @relation(fields: [task_id], references: [task_id])
}

model TaskAssignment {
  assignment_id String           @id @default(uuid()) // Changed to UUID
  task_id       String
  employee_id   String
  description   String
  status        AssignmentStatus
  created_at    DateTime         @default(now())
  updated_at    DateTime         @updatedAt

  // Mối quan hệ N:1 với Task
  task Task @relation(fields: [task_id], references: [task_id])

  // Mối quan hệ 1:N với Inspection
  inspections Inspection[]
}

model Inspection {
  inspection_id      String           @id @default(uuid())
  task_assignment_id String
  crack_id           String
  inspected_by       String
  inspection_date    DateTime
  image_url          String?
  description        String
  status             InspectionStatus
  created_at         DateTime         @default(now())
  updated_at         DateTime         @updatedAt

  // Mối quan hệ N:1 với TaskAssignment
  taskAssignment TaskAssignment @relation(fields: [task_assignment_id], references: [assignment_id])

  // Mối quan hệ 1:N với RepairMaterial
  repairMaterials RepairMaterial[]
}

model RepairMaterial {
  repair_material_id String   @id @default(uuid())
  task_id            String
  material_id        String
  quantity           Int
  unit_cost          Decimal  @db.Decimal(10, 2)
  total_cost         Decimal  @db.Decimal(10, 2)
  created_at         DateTime @default(now())
  updated_at         DateTime @updatedAt

  // Mối quan hệ N:1 với Inspection
  inspection_id String
  inspection    Inspection @relation(fields: [inspection_id], references: [inspection_id])

  // Mối quan hệ N:1 với Material
  material Material @relation(fields: [material_id], references: [material_id])
}

model Material {
  material_id    String   @id @default(uuid())
  name           String
  description    String?
  unit_price     Decimal  @db.Decimal(10, 2)
  stock_quantity Int
  created_at     DateTime @default(now())
  updated_at     DateTime @updatedAt

  // Mối quan hệ 1:N với RepairMaterial
  repairMaterials RepairMaterial[]
}

enum Status {
  Assigned
  InProgress
  Completed
}

enum AssignmentStatus {
  pending
  inprogress
  reassigned
  completed
  notcompleted
}

enum InspectionStatus {
  InProgress
  Completed
  Alert
}
